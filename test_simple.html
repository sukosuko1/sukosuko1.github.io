<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain">
	<style>
	
html, body { margin:0; padding:0; overflow:hidden }
#mysvg1 { position:absolute; top:0; bottom:0; left:0; right:0 }	
#mysvg2 { position:absolute; top:1200; bottom:0; left:0; right:0 }	

#container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}
        image {
             filter : "url(#blurMe)";
        }

	</style>
 <script src="d3/d3.js"></script>	
  <script src="svgfilters.js"></script>	
 <script src="svgmenu.js"></script>	
	
</head>
<body>
<object id="obj1" data="/pics/snake_greatergreen.jpg" type="image/svg+xml"></object>
    
<div id="container">
</div>

<svg id="mysvg2" height="240" width="440" border="2">
  <defs>
   <filter id="blurMe">
  <feGaussianBlur in="SourceGraphic" stdDeviation="1"/>
 </filter>
      

    <filter id="f2" y="-50" height="200">
      <feGaussianBlur result="blurOut" in="offOut" stdDeviation="30" />
      <feBlend in="blurOut" in2="SourceGraphic" mode="normal" />
    </filter>
  </defs>

  <rect x="20" y="70" width="90" height="90" stroke="blue" stroke-width="3"
  fill="blue" filter="url(#f2)" />

  <rect x="120" y="70" width="90" height="90" stroke="blue" stroke-width="3"
  fill="blue" filter="url(#blurMe)" />

</svg>
<image id="img1" src="/pics/snake_greatergreen.jpg" filter="url(#blurMe)"></image>
<image id="img1" src="/pics/snake_greatergreen.jpg" filter="url(#blurMe)"></image>
    
</body>
	
	
<script>
var width = self.frameElement ? 960 : innerWidth,
    height = self.frameElement ? 500 : innerHeight;

console.log("widthheight" + width + " " + height);
	
  	
let svg1 = d3.select("#container").append("svg")
	.attr("id","mysvg1")
   .attr("width", "100%")
   .attr("height", "100%")
	.attr("background-color","purple")

	let windowh = 100 * svg1.node().clientHeight / svg1.node().clientWidth;
	windowh+= 50;
	svg1.attr("viewBox","0 0 100 " + windowh);

	cmAddFilters(svg1);

let currentTouch = null;
let currentTouchSvg = null;

svg1.on('touchstart', function() {
	 currentTouch = d3.touches(this)[0];

	currentTouchSvg = svg1.append("circle")
	.attr("id","touchcircle")
	.attr("cx",currentTouch[0])
	.attr("cy",currentTouch[1])
	.attr("r",15)
	.style("stroke", d3.hsl(150,0.9,0.7))
	.style("fill","none")

	function transitionGrow() {
	currentTouchSvg.attr("r",15).
	     transition("grow")
		.duration(800)
		.ease(d3.easeExp)
		.attr("r",25)
		.on("end",transitionGrow)

	for (i=0; i < 5; i++) {
	 svg1.append("circle")
	.attr("id","bubble")
	.attr("cx",currentTouch[0]+Math.random()*10-5)
	.attr("cy",currentTouch[1])
	.attr("r",4)
//	.style("stroke", d3.hsl(150,0.9,0.7))
	.style("filter","url(#blurMe)")
	.style("fill","white")
	.style("opacity",0.01)
	.transition()
	.delay(d=>Math.random() * 1000)
	.style("opacity",0.3)
	.transition()
	.duration(3000)
	.ease(d3.easeLinear)
	.attr("r",5 + Math.random() * 3)
	.attr("cy",currentTouch[1]-30-Math.random()*10)
	.style("opacity",0.2)
	.transition()
	.duration(200)
		.style("opacity",0.2)
	.transition()
	.remove()
	}
		
	}
	transitionGrow();

	d3.event.preventDefault()

});

svg1.on('touchmove', function() {
	currentTouch = d3.touches(this)[0];

	currentTouchSvg.transition("move")
		.ease(d3.easeLinear)
		.attr("cx",currentTouch[0])
		.attr("cy",currentTouch[1])

	d3.event.preventDefault();

});

svg1.on('touchend', touchend)
svg1.on('touchcancel', touchend)

function touchend() {
	currentTouchSvg.transition("grow")
		.duration(800)
		.attr("r",35)
		.style("opacity",0.2)
		.remove();

	console.log("end");

}

svg1.on('gesturestart', function() {
	d3.event.preventDefault();
	console.log("prevent gestrue")
});
svg1.on('gesturemove', function() {
	d3.event.preventDefault();
	console.log("prevent gestrue2")
});
svg1.on('click', function() {
	d3.event.preventDefault();
	console.log("prevent click")
});

let filter = svg1.append("filter")
    .attr("id", "filterGlow")
	.append("feGaussianBlur")
    .attr("in", "SourceGraphic")
    .attr("result", "out1")
    .attr("stdDeviation", 5)
	.append("feBlend")
    .attr("in", "out1")
    .attr("in2", "SourceGraphic")
    .attr("mode", "normal")



svg1.append("rect")
	.attr("id","mysvg1fill")
	.attr("width","100%")
	.attr("height","100%")
	.attr("fill", "black")

svg1.append("image")
	.attr("href","pics/snake_greatergreen.jpg")
	.attr("xlink:href","pics/snake_greatergreen.jpg")
	.attr("x","0")
	.attr("y","0")
	.attr("width","100")
	.attr("height","100")
	.attr("transform","translate(0,0)")

svg1.append("image")
	.attr("href","pics/snake_greatergreen.jpg")
	.attr("xlink:href","pics/snake_greatergreen.jpg")
//	.attr("transform","scale(2.0)")
	.attr("x","0")
	.attr("y","0")
	.attr("width","100")
	.attr("height","100")
	.attr("transform","translate(0," + (windowh * 0.4) + ") ")
	.style("filter","url(#blurMe)")


// /Users/scottchristensen/sukosuko1.github.io/pics/snake_bamboo.jpg

let d = [1,2,3,4,5,6,7,8,9,10];
	
let rect1 = svg1.selectAll(".star")
	.data(d)
	.enter()
	.append("circle")
	.attr("class","star")
	.attr("id",(d,i) => "e" + i)
	.attr("cx",d=>Math.random()*95)
	.attr("cy",d=>Math.random()*windowh * 0.95)
	.attr("r",d=>Math.random()*20)
	.style("fill", d3.hsl(50,0.9,0.7))
//	.style("filter","url(#filterGlow)")

	rect1.on("touchstart", starTouchStart);
	rect1.on("touchcmove", starTouchMove);
	rect1.on("touchend", starTouchEnd);
	rect1.on("touchcancel", starTouchEnd);

function starTouchStart(){
	d3.select(this).transition()
		.attr("transform-origin","middle")
		.attr("transform","scale(0.9)")
}

function starTouchMove(){
}

function starTouchEnd(){
	d3.select(this).transition()
		.duration(1000)
		.attr("transform-origin","middle")
		.attr("transform","scale(1.05)")
		.attr("opacity","0.01")

	
}


function sparkle()
{
	svg1.selectAll(".star")
		.transition()
		.delay(d=>Math.random() * 5000)
		.duration(600)
		.attr("r",d=>Math.random()*20)
		.style("fill", d3.hsl(50,0.9,0.7))
		.transition()
		.duration(600)
		.style("fill", d3.hsl(50,0.8,0.7))
		.transition()
		.duration(600)
		.style("fill", d3.hsl(50,0.9,0.7))
		.transition()
		.duration(600)
		.style("fill", d3.hsl(50,0.8,0.7))
		.transition()
		.duration(600)
		.style("fill", d3.hsl(50,0.9,0.7))
		.transition()
		.duration(1000)
		.style("fill", d3.hsl(50,0.5,0.1))
		.attr("r",1)
		.on("end",function(d,i) {if (i==0) sparkle(); } )
	
}
	sparkle();
	
	let snum = 0;
	let elapsedPrev = 0;
	d3.timer(function(elapsed) {
	
	if (elapsed < elapsedPrev + 500) return;
		elapsedPrev = elapsed;

	/* test long object scrolling....

	let spark9 = svg1.append("rect")
	.attr("class","bar")
	.attr("id",(d,i) => "b" + snum++)
	.attr("x",30)
	.attr("y",100)
	.attr("width",20)
	.attr("height",3000)
	.style("fill", "orange")
	.style("filter","url(#filterdropshadow3)")
		*/

	let spark = svg1.append("rect")
	.attr("class","spark")
	.attr("id",(d,i) => "s" + snum++)
	.attr("x",d=> 45 + Math.random()*10)
	.attr("y",100)
	.attr("width",d=>Math.random()*5)
	.attr("height",d=>Math.random()*5)
	.style("fill", d3.hsl(50,0.9,0.1))
	
	spark.transition("move")
		.duration(5000)
		.attr("y", 70 + Math.random() * 20)
		
	spark.transition("flicker")
		.duration(600)
		.style("fill", d3.hsl(50,0.9,0.9))
		.transition()
		.style("fill", d3.hsl(50,0.8,0.8))
		.transition()
		.style("fill", d3.hsl(50,0.9,0.9))
		.transition()
		.style("fill", d3.hsl(50,0.7,0.8))
		.transition()
		.style("fill", d3.hsl(50,0.9,0.9))
		.transition()
		.duration(1000)
		.style("fill", d3.hsl(50,0.5,0.1))
		.transition()
		.remove();
		
	})


		
	let q1 = {"title":"Which snake is this?", 
	          "image":"pics/snake_greatergreen.jpg",
			  items: [
			  {"text":"red necked keelback","answer":0},
			  {"text":"chinese cobra","answer":1},
			  {"text":"bamboo snake","answer":0},
			  ]}
	
	let myFont = "luckiest guy";
			
	let menu1 = cmAddMenu(svg1, q1, cmMenuEvent);
	menu1.attr("transform","scale(0.3)")
	function cmMenuEvent(r) {
		console.log(r);
		svg1.append("text").text("AMAZING!").style("text-anchor","middle")
			.style("alignment-baseline","middle")
			.attr("font-family", myFont)
			.style("font-size","20px").attr("fill","white").attr("stroke","orange")
			.attr("x",50)
			.attr("y",50)
			.attr("transform-origin","center")
			.attr("transform","scale(0,0)")
			.transition()
			.attr("transform","scale(0,0.9)")
			.transition()
			.attr("transform","scale(1,1)")
			.transition()
			.delay(1000)
			.transition()
			.style("opacity",0)
			.transition()
			.remove();

	}

</script>
</html>
