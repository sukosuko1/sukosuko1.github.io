<html>
<head>
<style>

.dark-primary-color    { background: #C2185B; }
.default-primary-color { background: #E91E63; }
.light-primary-color   { background: #F8BBD0; }
.text-primary-color    { color: #FFFFFF; }
.accent-color          { background: #CDDC39; }
.primary-text-color    { color: #212121; }
.secondary-text-color  { color: #757575; }
.divider-color         { border-color: #BDBDBD; }
	
    #body1 {
        top: 0;
        bottom : 0;
        left : 0;
        right: 0;
        background-image: url("/pics/wallpaper.png");
		max-width: 100%;
    	overflow-x: hidden;		
        overflow-y: scroll;
        -webkit-overflow-scrolling: touch;
    }
    .imgcontainer {
        overflow: hidden;
		position: relative;
        height: 600px;
        left: 10%;
        width: 80%;
        margin-top: 8%;
		padding : 20px;
		filter: drop-shadow(-10px -10px white);
		border-radius: 5%;
		box-shadow: 5px 4px #666666;
    }
	img {
		position:absolute;
		padding : 10px;
		margin: 10px;
        overflow: hidden;
        filter: sepia(0.5);
        animation: xkeyImage 15s infinite;
	}
    div {
        color: #1a1a1a;
        font-size: 80px;
		font-weight: bold;
        font-family: 'Roboto', sans-serif;
         overflow: hidden;

    }
	
	.qlabel1{
		border: 10px black;
		background-color: beige;
		box-shadow: 5px 4px #666666;
		margin-left: 5%;
		margin-right: 7%;
		margin-top: 3%;
		padding-left: 20px;
		padding-top: 10px;
		padding-bottom: 10px;
		font-size: 4em;
		border-radius: 40px;
	}
	.qlabel2 {
		position: relative;
		border: 10px black;
		background-color: beige;
		box-shadow: 5px 4px #666666;
		margin-left: 15%;
		margin-right: 7%;
		margin-top: 3%;
		padding-left: 20px;
		padding-top: 80px;
		padding-bottom: 30px;
		font-size: 4em;
		border-radius: 40px;
         transition: background-color 0.2s;
	}
	.qlabeltrue {
		background-color: green;
	}
	.qlabelfalse {
		background-color: red;
	}
	.qlabelinactive {
         transition: background-color 3s;
		background-color: grey;
	}

	.imgcontainernum {
		position: absolute;
		top: 45px;
		left: 45px;
		z-index: 51;
        font-size: 60px;
		font-weight: bold;
        font-family: 'Roboto', sans-serif;
		color: #88eeaaaa;
	}
	.qlabelicon {
		position: absolute;
		width: 40px;
		height: 40px;
		bottom: 40px;
		right: 40px;
		transform: translate(-50%, -50%) scale(2.0);
		z-index: 50;
	}

	.svgicon {
		position: absolute;
		bottom: 15px;
		right: 20px;
		transform: translate(-50%, -50%) scale(2.0);
		z-index: 50;
	}

    .bottomtab {
		position: fixed;
		left: 80px;
		bottom: 0px; 
		border-radius: 40px;
		width: 140px;
		height: 140px;
		background: #CDDC39;
		z-index: 999;
    }
	.bottomtab:nth-child(1) {
		left: 20%;
	}
	.bottomtab:nth-child(2) {
		left: 45%;
	}
	.bottomtab:nth-child(3) {
		left: 70%;
	}
	
    .topsvg {
		position: fixed;
		border-radius: 10px;
		top: 0; 
		right: 80px;
		width: 80px;
		height: 80px;
		background: pink;
		z-index: 998;
    }

    .gcontainer {
    	transform: translate(-3000px,0px);
    }
    .displayleft {
    	transform: translate(0px,0px);
        animation: keyLeft 0.5s;
    }

    .displayon {
        color: blue;
    }
    .imageoutside {
    	transition: opacity  2s, transform 0.5s;;
    	opacity: 0.6;
        transform: scale(1.0) translate(0px,0px);
    }
    .imageinside {
    	transition: opacity  2s, transform 10s;
    	opacity: 1.0;
        transform: scale(1.5) translate(10px,-5px);
    }
	.textactive {
		position: absolute;
		color: green;
		top: 0;
		left: 0;
	}
	.svgoverlay {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}

    @keyframes keyLeft {
        0% { transform: translate(-400px,0px);}
        100% { transform: translate(0px,0px); }
    }
    
    @keyframes keyImage {
        0% { transform: scale(1.0) translate(20px,0px);}
        80% { transform: scale(1.5) translate(10px,-5px);}
        100% { transform: scale(1.0) translate(20px,0px); }
    }
    input {
    	height: 200px;
    	width: 200px;
    }

input[type="radio"].toggle {
  display: none;
}

input[type="radio"].toggle:checked + label {
  /* Do something special with the selected state */
}
    
</style>
	
 <script src="d3/d3.js"></script>	
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	
</head>
<body id="body1">



<div class="bottomtab" left="40px"></div>
<div class="bottomtab" left="200px"></div>
	
<div class="bottomtab" right="30px">hello</div>

<svg class="topsvg"></svg>

</body>
	
<script>
	/*
    let piclist = [
		{src: "pics/snake_mockviper.jpg", response1:"Rat Snake", response2:"Greater Green Snake" }
		];*/
	

    let piclist = [
		{"src": "pics/snake_mockviper.jpg", "response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_redneckedkeelback.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_manybandedkrait.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_ratsnake.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_bamboo.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_chinesecobra.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_greatergreen.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_indochineseratsnake.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_spottedslug.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_burmesepython.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_bamboo.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_chinesecobra.jpg","response1":"Rat Snake","response2":"Greater Green Snake"},
		{"src": "pics/snake_greatergreen.jpg","response1":"Rat Snake","response2":"Greater Green Snake"}
    ];

		
	
	let newnodes = d3.select("#body1")
		.data(piclist)
		.enter()
		.append("g")
        .attr("id", (d,i) => "group" + i)

	let eimagecontainer = newnodes.append("div")
		.attr("width", "100%")
        .attr("transform","translate(-300px,0px)")
        .attr("id", (d,i) => "div" + i)
        .classed("imgcontainer", true)
		.each(function(d) {d.clicked = false})
        .on("click", eventClick)

     eimagecontainer.append("img")
		.attr("src", d => d.src)
		.attr("width", "100%")
        .attr("position","absolute")

	esvgicon = eimagecontainer.append("svg")
		.attr("width","40px")
		.attr("height","40px")
		.classed("svgicon", true)
	
	eimagecontainer.append("div")
		.classed("imgcontainernum", true)
		.text((d,i)=> "Level " + i)

	for (let i = 0; i < 3; i++) {
	esvgicon.append("path")
		.attr("d","M38 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM20 34L10 24l2.83-2.83L20 28.34l15.17-15.17L38 16 20 34z")
//		.attr("d","M33 6c-3.48 0-6.82 1.62-9 4.17C21.82 7.62 18.48 6 15 6 8.83 6 4 10.83 4 17c0 7.55 6.8 13.72 17.1 23.07L24 42.7l2.9-2.63C37.2 30.72 44 24.55 44 17c0-6.17-4.83-11-11-11zm-8.79 31.11l-.21.19-.21-.19C14.28 28.48 8 22.78 8 17c0-3.99 3.01-7 7-7 3.08 0 6.08 1.99 7.13 4.72h3.73C26.92 11.99 29.92 10 33 10c3.99 0 7 3.01 7 7 0 5.78-6.28 11.48-15.79 20.11Z")
		.style("fill","white")
		.style("stroke","black")
		.attr("z-index",50)
		.attr("transform", "translate(0," + (i * -20)+ ")" )
	}
	

	newnodes.append("div")
		.classed("qlabel1", true)
//		.html(d=>d.src)
		.html("Which?")
	
	newnodes.append("div")
		.classed("qlabel2", true)
		.html(d=>d.response1)
		.datum({})
		.on("click", qlabelEvent)
		.append("svg").attr("class","qlabelicon")
		.append("path")
		.attr("d","M38 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM20 34L10 24l2.83-2.83L20 28.34l15.17-15.17L38 16 20 34z")
		.attr("fill","#EEEEEE")
		.attr("stroke","black")
		.attr("z-index",50)
	
	newnodes.append("div")
		.classed("qlabel2", true)
		.html(d=>d.response2)
		.datum({})
		.on("click", qlabelEvent)
		.append("svg").attr("class","qlabelicon")
		.append("path")
		.attr("d","M38 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM20 34L10 24l2.83-2.83L20 28.34l15.17-15.17L38 16 20 34z")
		.attr("fill","#EEEEEE")
		.attr("stroke","black")
		.attr("z-index",50)
	
	newnodes.append("div")
		.classed("qlabel2", true)
		.html(d=>d.response2)
		.datum({})
		.on("click", qlabelEvent)
		.append("svg").attr("class","qlabelicon")
		.append("path")
		.attr("d","M38 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM20 34L10 24l2.83-2.83L20 28.34l15.17-15.17L38 16 20 34z")
		.attr("fill","#EEEEEE")
		.attr("stroke","black")
		.attr("z-index",50)


	function qlabelEvent() {
		let e = d3.select(this);

		e.each(function(d,i) {
			if (!d.hasOwnProperty("state")) {
				d.state = 0;
			}
			if (d.state != 0) {
				e.transition()
					.style("opacity", 0.5)
					.transition()
					.style("opacity", 1.0)

			} else {
				d.state = 1;
				console.log("setting " + i)
			}

		})

		d3.select(this.parentNode).selectAll(".qlabel2")
			.each(function(d) {
				if (!d.hasOwnProperty("state")) {
					d.state = 0;
				}
				 if (d.state == 0) {
					d.state = 3;
				}
			})

		d3.selectAll(".qlabel2")
			.classed("qlabelinactive", d => (d.state==3))
			.classed("qlabeltrue", d => (d.state==1))
			.classed("qlabelfalse", d => (d.state==2))
		 	

	}

	function eventClick(d) {
		let eimg = d3.select(this).select("img")

		if (d.clicked == true) {
			d3.select(this).select("svg").selectAll("circle")
				.transition()
				.attr("cx",-50)
			
			d3.select(this).select("svg").select("g")
				.transition()
				.delay(800)
				.attr("transform","translate(150,0)")
				
			d3.select(this).select("svg")
				.transition()
				.duration(3000)
				.remove();
			
			d.clicked = false;
			return;
		}
		d.clicked = true;
		
		d3.select(this).append("text")
			.attr("class", "textactive")
			.attr("position","absolute")
			.attr("top",0)
			.attr("left",0)
			.attr("z-index",20)
			.text("hello world absolute positions")
		
		let svgoverlay = d3.select(this).append("svg")
			.attr("class", "svgoverlay")
			.attr("viewBox","0 0 100 100")
			.attr("border","3px solid #73AD21")
			.attr("z-index",30)
		
		
		for (let i = 0; i < 20; i++) {
			let ecircle = svgoverlay.append("circle")
			.datum(Math.random())
			.attr("cx", d=> (d > 0.5 ? 130: - 30))
			.attr("cy", d=> Math.random()* 100)
			.attr("r","5")
			.attr("fill","yellow")
			.transition()
			.ease(d3.easeElastic)
			.duration(2000)
			.attr("cx", d=> d>0.5 ? 50 + Math.random()* 50 : Math.random()* 50)
			.attr("cy", d=> Math.random()* 100)
			
		}

/*
		eimg.attr("transform","translate(50,0) scale(1.2)")
			.transition()
			.style("opacity",0.1)
			.transition()
			.style("opacity",0.2)
*/
//#e148,#e165,#e210
		
		let rnum = Math.floor(Math.random() * 4); let strgroup = "";
		if (rnum == 0) strgroup = "#e148";
		if (rnum == 1) strgroup = "#e165";
		if (rnum == 2) strgroup = "#e186";
		if (rnum == 3) strgroup = "#e210";
		
		var nodeNew = d3.select(strgroup).node().cloneNode(true);
		
		let edropin = svgoverlay.append("g");
		
		edropin.node().appendChild(nodeNew);
		
		let pos = nodeNew.getBoundingClientRect();
//				if (pos.y > 0 && pos.y <  window.innerHeight) {
		
		edropin.attr("transform", "translate(50,-30) scale(0.1) ")
			.transition()
			.duration(3000)
			.ease(d3.easeElastic)
			.attr("transform", "translate(0,-30) scale(0.1) ");
		
		edropin.attr("id", "o186").attr("z-index",40);
		
					
					
		console.log("click");
	}

	document.addEventListener("scroll", scrollEvent);
	
	
	let scrollPtr = 200;
    let scrollTime = 0;
	function scrollEvent(e) {
        scrollTime = +new Date();
        
//		console.log(document.body.scrollTop);
var body = document.body,
    html = document.documentElement;

var height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );
		
		console.log(document.body.scrollTop / ( height - window.innerHeight)); 


		d3.selectAll(".gcontainer")
			.each(function(d,i) {
				let pos = this.getBoundingClientRect();
				if (pos.y > 0 && pos.y <  window.innerHeight) {
					d3.select(this).classed("displayleft", true);
				}
			})

		d3.selectAll(".imgcontainer")
			.each(function(d,i) {
				let pos = this.getBoundingClientRect();
				if (pos.y > 0 && pos.bottom <  window.innerHeight) {
					d3.select(this).select("img").classed("imageoutside", false);
					d3.select(this).select("img").classed("imageinside", true);
				} else {
					d3.select(this).select("img").classed("imageoutside", true);
					d3.select(this).select("img").classed("imageinside", false);
				}
			})

			/*
			.classed("displayon", function(d,i) {
				let pos = this.getBoundingClientRect();
				if (pos.y > 0 && pos.y < 0.4 * window.innerHeight) return false;
				return true;
			}) */



		if (document.body.scrollTop > height - window.innerHeight - 40) {
			
			/*
		var node = document.createElement("p");  
		var textnode = document.createTextNode("Water" + scrollPtr++);         // Create a text node
		node.appendChild(textnode)
		document.getElementById("body1").appendChild(node);  
		*/
			/*
		if (Math.random() < 0.1) {
			d3.select("body").append("svg")
				.attr("height",40)
				.attr("width",100)
				.attr("fill","green")
				.attr("border","1")
				.append("rect")
				.attr("height",40)
				.attr("width",100)
				.attr("fill","green")
			.style("transform","scale(0.05)")
			.transition()
			.delay(300)
			.ease(d3.easeElastic)
			.duration(700)
			.style("transform","scale(1.0)")
			
		} else {
		d3.select("body").append("div").html("ice " + scrollPtr++)
			.attr("fill","blue")
			.style("opacity","0.1")
			.transition()
			.duration(700)
			.style("opacity","1.0")
		}
			*/
			
		}
	}
	
	for (let n = 0; n < 100; n++) {
		/*
		var node = document.createElement("p");  
		var textnode = document.createTextNode("Water" + n);         // Create a text node
		node.appendChild(textnode)
		document.getElementById("body1").appendChild(node);  
		*/
		
		
//		d3.select("body").append("div").html("ice " + n)
	}
    
    /*
document.querySelector('.hello').scrollIntoView({ 
  behavior: 'smooth' 
});	*/
    
    let scrollAutoTime = 0;
    function tick() {
        
        if ( (scrollTime > 0) && (scrollTime < +new Date() - 800) ) {
            if (scrollAutoTime > +new Date() - 2500) {
                scrollTime = 0;
            } else {
                scrollAutoTime = +new Date();
                var body = document.body,
                    html = document.documentElement;

                var height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );
		
            
            scrollTime = 0;
            console.log("adjust")
            console.log(" prevAutoScroll = " + (+new Date() - scrollAutoTime))
                
            }
        }
        window.requestAnimationFrame(tick);
    }
    tick();
    
	

  d3.xml("cutecritters.svg").mimeType("image/svg+xml").get(function(error, xml) {
  if (error) throw error;
  xml.documentElement.setAttribute("id", "mysvg1");
  xml.documentElement.setAttribute("display", "none");
  document.body.appendChild(xml.documentElement);
	  
	d3.selectAll("#mysvg1 *")
		.attr("id", (d,i)=>"e"+i)

  });
	
</script>
</html>


