<html>
<head>
<style>
    #body1 {
        position: absolute;
        top: 0;
        bottom : 0;
        left : 0;
        right: 0;
        background-color: aquamarine;
        overflow-y: scroll;
        -webkit-overflow-scrolling: touch;
    }
    .imgcontainer {
        overflow: hidden;
        height: 600px;
        width: 100%;
		padding : 20px;
    }
	img {
		padding : 10px;
		margin: 10px;
        overflow: hidden;
        filter: sepia();
        animation: keyImage 15s infinite;
	}
    div {
        color: black;
        font-size: 20px;
        font-family: fantasy;
    }

    .bottomtab {
		position: fixed;
		bottom: 0px; 
		rx: 20px;
		ry: 20px;
		width: 80px;
		height: 80px;
		background: blue;
		z-index: 999;
    }

    .gcontainer {
    	transform: translate(-3000px,0px);
    }
    .displayleft {
    	transform: translate(0px,0px);
        animation: keyLeft 0.5s;
    }

    .displayon {
        color: blue;
    }
    @keyframes keyLeft {
        0% { transform: translate(-400px,0px);}
        100% { transform: translate(0px,0px); }
    }
    
    @keyframes keyImage {
        0% { transform: scale(1.0) translate(20px,0px);}
        80% { transform: scale(1.5) translate(10px,-5px);}
        100% { transform: scale(1.0) translate(20px,0px); }
    }
    
</style>
	
 <script src="d3/d3.js"></script>	

</head>
<body id="body1">

<div class="bottomtab" left="40px"></div>
<div class="bottomtab" left="200px"></div>
<div class="bottomtab" left="340px"></div>

</body>
	
<script>

    let piclist = [
		"pics/snake_mockviper.jpg",
		"pics/snake_manybandedkrait.jpg",
		"pics/snake_redneckedkeelback.jpg",
		"pics/snake_ratsnake.jpg",
		"pics/snake_bamboo.jpg",
		"pics/snake_chinesecobra.jpg",
		"pics/snake_greatergreen.jpg",
		"pics/snake_indochineseratsnake.jpg",
		"pics/snake_spottedslug.jpg",
		"pics/snake_burmesepython.jpg",
    ];

	let newnodes = d3.select("#body1")
		.data(piclist)
		.enter()
		.append("g")
        .attr("id", (d,i) => "group" + i)

	newnodes.append("div")
		.attr("width", "100%")
        .attr("transform","translate(-300px,0px)")
        .attr("id", (d,i) => "div" + i)
        .classed("imgcontainer", true)
        .append("img")
		.attr("src", d => d)
		.attr("width", "100%")

	newnodes.append("p")
		.append("div")
		.classed("gcontainer", true)
		.html(d=>d)



	document.addEventListener("scroll", scrollEvent);
	
	
	let scrollPtr = 200;
    let scrollTime = 0;
	function scrollEvent(e) {
        scrollTime = +new Date();
        
//		console.log(document.body.scrollTop);
var body = document.body,
    html = document.documentElement;

var height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );
		
		console.log(document.body.scrollTop / ( height - window.innerHeight)); 
		

		d3.selectAll(".gcontainer")
			.each(function(d,i) {
				let pos = this.getBoundingClientRect();
				if (pos.y > 0 && pos.y <  window.innerHeight) {
					d3.select(this).classed("displayleft", true);
				}
			})

			/*
			.classed("displayon", function(d,i) {
				let pos = this.getBoundingClientRect();
				if (pos.y > 0 && pos.y < 0.4 * window.innerHeight) return false;
				return true;
			}) */



		if (document.body.scrollTop > height - window.innerHeight - 40) {
			
			/*
		var node = document.createElement("p");  
		var textnode = document.createTextNode("Water" + scrollPtr++);         // Create a text node
		node.appendChild(textnode)
		document.getElementById("body1").appendChild(node);  
		*/
			
		if (Math.random() < 0.1) {
			d3.select("body").append("svg")
				.attr("height",40)
				.attr("width",100)
				.attr("fill","green")
				.attr("border","1")
				.append("rect")
				.attr("height",40)
				.attr("width",100)
				.attr("fill","green")
			.style("transform","scale(0.05)")
			.transition()
			.delay(300)
			.ease(d3.easeElastic)
			.duration(700)
			.style("transform","scale(1.0)")
			
		} else {
		d3.select("body").append("div").html("ice " + scrollPtr++)
			.attr("fill","blue")
			.style("opacity","0.1")
			.transition()
			.duration(700)
			.style("opacity","1.0")
		}
			
			
		}
	}
	
	for (let n = 0; n < 100; n++) {
		/*
		var node = document.createElement("p");  
		var textnode = document.createTextNode("Water" + n);         // Create a text node
		node.appendChild(textnode)
		document.getElementById("body1").appendChild(node);  
		*/
		
		
//		d3.select("body").append("div").html("ice " + n)
	}
    
    /*
document.querySelector('.hello').scrollIntoView({ 
  behavior: 'smooth' 
});	*/
    
    let scrollAutoTime = 0;
    function tick() {
        
        if ( (scrollTime > 0) && (scrollTime < +new Date() - 800) ) {
            if (scrollAutoTime > +new Date() - 2500) {
                scrollTime = 0;
            } else {
                scrollAutoTime = +new Date();
                var body = document.body,
                    html = document.documentElement;

                var height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );
		
            
            scrollTime = 0;
            console.log("adjust")
            console.log(" prevAutoScroll = " + (+new Date() - scrollAutoTime))
                
            }
        }
        window.requestAnimationFrame(tick);
    }
    tick();
    
</script>
</html>


