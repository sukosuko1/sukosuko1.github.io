<html>
<head>
<style>

.dark-primary-color    { background: #C2185B; }
.default-primary-color { background: #E91E63; }
.light-primary-color   { background: #F8BBD0; }
.text-primary-color    { color: #FFFFFF; }
.accent-color          { background: #CDDC39; }
.primary-text-color    { color: #212121; }
.secondary-text-color  { color: #757575; }
.divider-color         { border-color: #BDBDBD; }
	
    #body1 {
        top: 0;
        bottom : 0;
        left : 0;
        right: 0;
        background-color: #000000;
		max-width: 100%;
    	overflow-x: hidden;		
        overflow-y: scroll;
        -webkit-overflow-scrolling: touch;
    }
    .imgcontainer {
        overflow: hidden;
		position: relative;
        height: 600px;
        width: 100%;
		padding : 20px;
    }
	img {
		padding : 10px;
		margin: 10px;
        overflow: hidden;
        filter: sepia();
        animation: keyImage 15s infinite;
	}
    div {
        color: #CDDC39;
        font-size: 80px;
		font-weight: bold;
        font-family: 'Roboto', sans-serif;
    }

    .bottomtab {
		position: fixed;
		left: 80px;
		bottom: 0px; 
		border-radius: 40px;
		width: 140px;
		height: 140px;
		background: #CDDC39;
		z-index: 999;
    }
	.bottomtab:nth-child(1) {
		left: 20%;
	}
	.bottomtab:nth-child(2) {
		left: 45%;
	}
	.bottomtab:nth-child(3) {
		left: 70%;
	}
	
    .topsvg {
		position: fixed;
		border-radius: 10px;
		top: 0; 
		right: 80px;
		width: 80px;
		height: 80px;
		background: pink;
		z-index: 998;
    }

    .gcontainer {
    	transform: translate(-3000px,0px);
    }
    .displayleft {
    	transform: translate(0px,0px);
        animation: keyLeft 0.5s;
    }

    .displayon {
        color: blue;
    }
    .imageoutside {
    	transition: opacity  2s;
    	opacity: 0.6;
    }
    .imageinside {
    	transition: opacity  2s;
    	opacity: 1.0;
    }
	.textactive {
		position: absolute;
		color: green;
		top: 0;
		left: 0;
	}
	.svgoverlay {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}

    @keyframes keyLeft {
        0% { transform: translate(-400px,0px);}
        100% { transform: translate(0px,0px); }
    }
    
    @keyframes keyImage {
        0% { transform: scale(1.0) translate(20px,0px);}
        80% { transform: scale(1.5) translate(10px,-5px);}
        100% { transform: scale(1.0) translate(20px,0px); }
    }
    input {
    	height: 200px;
    	width: 200px;
    }

input[type="radio"].toggle {
  display: none;
}

input[type="radio"].toggle:checked + label {
  /* Do something special with the selected state */
}
    
</style>
	
 <script src="d3/d3.js"></script>	
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	
</head>
<body id="body1">



<div class="bottomtab" left="40px"></div>
<div class="bottomtab" left="200px"></div>
	
<div class="bottomtab" right="30px">hello</div>

<svg class="topsvg"></svg>

</body>
	
<script>

    let piclist = [
		{"src": "pics/snake_mockviper.jpg"},
		{"src": "pics/snake_redneckedkeelback.jpg"},
		{"src": "pics/snake_manybandedkrait.jpg"},
		{"src": "pics/snake_ratsnake.jpg"},
		{"src": "pics/snake_bamboo.jpg"},
		{"src": "pics/snake_chinesecobra.jpg"},
		{"src": "pics/snake_greatergreen.jpg"},
		{"src": "pics/snake_indochineseratsnake.jpg"},
		{"src": "pics/snake_spottedslug.jpg"},
		{"src": "pics/snake_burmesepython.jpg"},
		{"src": "pics/snake_bamboo.jpg"},
		{"src": "pics/snake_chinesecobra.jpg"},
		{"src": "pics/snake_greatergreen.jpg"},
		{"src": "pics/snake_indochineseratsnake.jpg"},
		{"src": "pics/snake_spottedslug.jpg"},
		{"src": "pics/snake_burmesepython.jpg"},
    ];

	let newnodes = d3.select("#body1")
		.data(piclist)
		.enter()
		.append("g")
        .attr("id", (d,i) => "group" + i)

	newnodes.append("div")
		.attr("width", "100%")
        .attr("transform","translate(-300px,0px)")
        .attr("id", (d,i) => "div" + i)
        .classed("imgcontainer", true)
		.each(function(d) {d.clicked = false})
        .attr("position","relative")
        .on("click", eventClick)
        .append("img")
		.attr("src", d => d.src)
		.attr("width", "100%")
        .attr("position","absolute")

	newnodes.append("p")
		.append("div")
		.classed("gcontainer", true)
		.html(d=>d.src)

	function eventClick(d) {
		let eimg = d3.select(this).select("img")

		if (d.clicked == true) {
			d3.select(this).select("svg").selectAll("circle")
				.transition()
				.attr("cx",-50)
			
			d3.select(this).select("svg").select("g")
				.transition()
				.delay(800)
				.attr("transform","translate(150,0)")
				
			d3.select(this).select("svg")
				.transition()
				.duration(5000)
				.remove();
			
			d.clicked = false;
			return;
		}
		d.clicked = true;
		
		d3.select(this).append("text")
			.attr("class", "textactive")
			.attr("position","absolute")
			.attr("top",0)
			.attr("left",0)
			.attr("z-index",20)
			.text("hello world absolute positions")
		
		let svgoverlay = d3.select(this).append("svg")
			.attr("class", "svgoverlay")
			.attr("viewBox","0 0 100 100")
			.attr("border","3px solid #73AD21")
			.attr("z-index",30)
		
		
		for (let i = 0; i < 20; i++) {
			let ecircle = svgoverlay.append("circle")
			.datum(Math.random())
			.attr("cx", d=> (d > 0.5 ? 130: - 30))
			.attr("cy", d=> Math.random()* 100)
			.attr("r","5")
			.attr("fill","yellow")
			.transition()
			.ease(d3.easeElastic)
			.duration(2000)
			.attr("cx", d=> d>0.5 ? 50 + Math.random()* 50 : Math.random()* 50)
			.attr("cy", d=> Math.random()* 100)
			
		}

/*
		eimg.attr("transform","translate(50,0) scale(1.2)")
			.transition()
			.style("opacity",0.1)
			.transition()
			.style("opacity",0.2)
*/
//#e148,#e165,#e210
		
		let rnum = Math.floor(Math.random() * 4); let strgroup = "";
		if (rnum == 0) strgroup = "#e148";
		if (rnum == 1) strgroup = "#e165";
		if (rnum == 2) strgroup = "#e186";
		if (rnum == 3) strgroup = "#e210";
		
		var nodeNew = d3.select(strgroup).node().cloneNode(true);
		
		let edropin = svgoverlay.append("g");
		
		edropin.node().appendChild(nodeNew);
		
		let pos = nodeNew.getBoundingClientRect();
//				if (pos.y > 0 && pos.y <  window.innerHeight) {
		
		edropin.attr("transform", "translate(50,-30) scale(0.1) ")
			.transition()
			.duration(3000)
			.ease(d3.easeElastic)
			.attr("transform", "translate(0,-30) scale(0.1) ");
		
		edropin.attr("id", "o186").attr("z-index",40);
		
					
					
		console.log("click");
	}

	document.addEventListener("scroll", scrollEvent);
	
	
	let scrollPtr = 200;
    let scrollTime = 0;
	function scrollEvent(e) {
        scrollTime = +new Date();
        
//		console.log(document.body.scrollTop);
var body = document.body,
    html = document.documentElement;

var height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );
		
		console.log(document.body.scrollTop / ( height - window.innerHeight)); 


		d3.selectAll(".gcontainer")
			.each(function(d,i) {
				let pos = this.getBoundingClientRect();
				if (pos.y > 0 && pos.y <  window.innerHeight) {
					d3.select(this).classed("displayleft", true);
				}
			})

		d3.selectAll(".imgcontainer")
			.each(function(d,i) {
				let pos = this.getBoundingClientRect();
				if (pos.y > 0 && pos.bottom <  window.innerHeight) {
					d3.select(this).classed("imageoutside", false);
					d3.select(this).classed("imageinside", true);
				} else {
					d3.select(this).classed("imageoutside", true);
					d3.select(this).classed("imageinside", false);
				}
			})

			/*
			.classed("displayon", function(d,i) {
				let pos = this.getBoundingClientRect();
				if (pos.y > 0 && pos.y < 0.4 * window.innerHeight) return false;
				return true;
			}) */



		if (document.body.scrollTop > height - window.innerHeight - 40) {
			
			/*
		var node = document.createElement("p");  
		var textnode = document.createTextNode("Water" + scrollPtr++);         // Create a text node
		node.appendChild(textnode)
		document.getElementById("body1").appendChild(node);  
		*/
			/*
		if (Math.random() < 0.1) {
			d3.select("body").append("svg")
				.attr("height",40)
				.attr("width",100)
				.attr("fill","green")
				.attr("border","1")
				.append("rect")
				.attr("height",40)
				.attr("width",100)
				.attr("fill","green")
			.style("transform","scale(0.05)")
			.transition()
			.delay(300)
			.ease(d3.easeElastic)
			.duration(700)
			.style("transform","scale(1.0)")
			
		} else {
		d3.select("body").append("div").html("ice " + scrollPtr++)
			.attr("fill","blue")
			.style("opacity","0.1")
			.transition()
			.duration(700)
			.style("opacity","1.0")
		}
			*/
			
		}
	}
	
	for (let n = 0; n < 100; n++) {
		/*
		var node = document.createElement("p");  
		var textnode = document.createTextNode("Water" + n);         // Create a text node
		node.appendChild(textnode)
		document.getElementById("body1").appendChild(node);  
		*/
		
		
//		d3.select("body").append("div").html("ice " + n)
	}
    
    /*
document.querySelector('.hello').scrollIntoView({ 
  behavior: 'smooth' 
});	*/
    
    let scrollAutoTime = 0;
    function tick() {
        
        if ( (scrollTime > 0) && (scrollTime < +new Date() - 800) ) {
            if (scrollAutoTime > +new Date() - 2500) {
                scrollTime = 0;
            } else {
                scrollAutoTime = +new Date();
                var body = document.body,
                    html = document.documentElement;

                var height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );
		
            
            scrollTime = 0;
            console.log("adjust")
            console.log(" prevAutoScroll = " + (+new Date() - scrollAutoTime))
                
            }
        }
        window.requestAnimationFrame(tick);
    }
    tick();
    
	

  d3.xml("cutecritters.svg").mimeType("image/svg+xml").get(function(error, xml) {
  if (error) throw error;
  xml.documentElement.setAttribute("id", "mysvg1");
  xml.documentElement.setAttribute("display", "none");
  document.body.appendChild(xml.documentElement);
	  
	d3.selectAll("#mysvg1 *")
		.attr("id", (d,i)=>"e"+i)

  });
	
</script>
</html>


